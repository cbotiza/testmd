<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Testmd by nvoxland</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/main.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>

      <header>
        <h1>Testmd</h1>
        <p>TestMD Testing Library</p>
      </header>

      <div id="banner">
        <span id="logo"></span>

        <a href="https://github.com/nvoxland/testmd" class="button fork"><strong>View On GitHub</strong></a>
        <div class="downloads">
          <span>Downloads:</span>
          <ul>
            <li><a href="https://github.com/nvoxland/testmd/zipball/master" class="button">ZIP</a></li>
            <li><a href="https://github.com/nvoxland/testmd/tarball/master" class="button">TAR</a></li>
          </ul>
        </div>
      </div><!-- end banner -->

    <div class="wrapper">
      <nav>
        <ul></ul>
      </nav>
      <section>
        <h1>
<a id="testmd-fast-integration-testing-java" class="anchor" href="#testmd-fast-integration-testing-java" aria-hidden="true"><span class="octicon octicon-link"></span></a>TestMD: Fast Integration Testing (Java)</h1>

<p>Automated testing of interactions between systems is difficult.</p>

<p>Tests normally fall in two quadrants</p>

<ul>
<li>
<strong>"Unit Testing"</strong> which perform fast, but but require mocking all external systems to be fast. This makes your tests only as valid as your assertions since the interaction with the external system is never actually tested.</li>
<li>
<strong>"Integration Testing"</strong> which ensures the interaction with the external system is correct, but at the expense tests that are not only slow but also reliant on specific environments which are not always available</li>
</ul>

<p>TestMD gives you the speed of unit testing with the safety of integration testing by tracking how the integration is done and performing a time-consuming integration test IF AND ONLY IF there has been a change.</p>

<p>Results of new and previous results are stored in markdown-formatted files that are designed to be human readable both in pull requests and through github source views.</p>

<p><img src="README.quadrants.png" alt="Quadrants"></p>

<p><strong>TestMD: <em>Complete When You Need It, Fast When You Don'tâ„¢</em></strong></p>

<h2>
<a id="features" class="anchor" href="#features" aria-hidden="true"><span class="octicon octicon-link"></span></a>Features</h2>

<p><strong>Previously Accepted Tests Stored As Markdown Format</strong> integrates well with GitHub or any other version control views that support markdown formatting. </p>

<p><strong>Previous Accepted Permutations Can Be Grouped As Tables</strong> as needed to improve readability.</p>

<p><strong>Works with JUnit, Spock, or any other testing framework</strong></p>

<p><strong>Supports Saving "Unverified" results</strong> Found a change in logic but you cannot run the automated tests? New accepted results can be committed that are marked as "unverified" and future runs will attempt to verify them automatically. </p>

<h2>
<a id="getting-started-sql-example" class="anchor" href="#getting-started-sql-example" aria-hidden="true"><span class="octicon octicon-link"></span></a>Getting Started: SQL Example</h2>

<h4>
<a id="start-the-test" class="anchor" href="#start-the-test" aria-hidden="true"><span class="octicon octicon-link"></span></a>Start The Test</h4>

<p>The <em>insertData()</em> method in <a href="src/test/java/com/example/ExampleLogic.java#L9">com.example.ExampleLogic</a> is a simple example of a class that generates SQL.</p>

<p>If you are using JUnit, it is easiest to use the <em>TestMDRule</em> class to automatically manage test naming. For more control, see <a href="http://nvoxland.github.io/testmd/javadoc/testmd/TestMD.html">testmd.TestMd</a>.</p>

<pre><code>@Rule
public TestMDRule testmd = new TestMDRule();
</code></pre>

<p>You can then begin writing your test by capturing the output of <em>insertData</em> for your input under test</p>

<div class="highlight highlight-java"><pre>@<span class="pl-stj">Test</span>
<span class="pl-s">public</span> <span class="pl-st">void</span> insertingData_simple() throws <span class="pl-stj">Exception</span> {
    <span class="pl-stj">String</span> tableName <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>test_table<span class="pl-pds">"</span></span>;
    <span class="pl-st">String</span>[] columns <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">String</span>[] {<span class="pl-s1"><span class="pl-pds">"</span>age<span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>};
    <span class="pl-st">Object</span>[] values <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">Object</span>[] {<span class="pl-c1">42</span>, <span class="pl-s1"><span class="pl-pds">"</span>Fred<span class="pl-pds">"</span></span>}; 
    <span class="pl-stj">String</span> sql <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">ExampleLogic</span>()<span class="pl-k">.</span>generateInsertSql(tableName, columns, values);

    <span class="pl-c">//GOING TO ADD MORE HERE</span>
}</pre></div>

<p>All the test is doing so far is calling the method that generates an insert statement and saving the SQL for testing. At this point, there should be no calls out to external systems or anything else that would slow the test execution because this portion of the test is ALWAYS executed.</p>

<p>Once you have the SQL, we will use TestMD to ensure that it is correct by actually executing it if and only if it is changed.</p>

<h4>
<a id="define-parameteres" class="anchor" href="#define-parameteres" aria-hidden="true"><span class="octicon octicon-link"></span></a>Define Parameteres</h4>

<p>First, we define a new permutation and describe it with parameters. The parameters uniquely identify the permutation:</p>

<div class="highlight highlight-java"><pre>@<span class="pl-stj">Test</span>
<span class="pl-s">public</span> <span class="pl-st">void</span> insertingData_simple() throws <span class="pl-stj">Exception</span> {
    <span class="pl-stj">String</span> tableName <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>test_table<span class="pl-pds">"</span></span>;
    <span class="pl-st">String</span>[] columns <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">String</span>[] {<span class="pl-s1"><span class="pl-pds">"</span>age<span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>};
    <span class="pl-st">Object</span>[] values <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">Object</span>[] {<span class="pl-c1">42</span>, <span class="pl-s1"><span class="pl-pds">"</span>Fred<span class="pl-pds">"</span></span>};
    <span class="pl-stj">String</span> sql <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">ExampleLogic</span>()<span class="pl-k">.</span>generateInsertSql(tableName, columns, values);

    testmd<span class="pl-k">.</span>permutation()
            .addParameter(<span class="pl-s1"><span class="pl-pds">"</span>tableName<span class="pl-pds">"</span></span>, tableName)
            .addParameter(<span class="pl-s1"><span class="pl-pds">"</span>columns<span class="pl-pds">"</span></span>, columns)
            .addParameter(<span class="pl-s1"><span class="pl-pds">"</span>values<span class="pl-pds">"</span></span>, values);
    <span class="pl-c">//GOING TO ADD MORE HERE</span>
}</pre></div>

<p>Notice that the <em>TestMD</em> object is designed to simply chain method calls together for an easier to read test. You should add a parameter for each key/value that helps uniquely identify this particular test case.</p>

<h4>
<a id="define-results" class="anchor" href="#define-results" aria-hidden="true"><span class="octicon octicon-link"></span></a>Define Results</h4>

<p>Once we have a parameters defined, we add our "results" to the permutation:</p>

<div class="highlight highlight-java"><pre>@<span class="pl-stj">Test</span>
<span class="pl-s">public</span> <span class="pl-st">void</span> insertingData_simple() throws <span class="pl-stj">Exception</span> {
    <span class="pl-stj">String</span> tableName <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>test_table<span class="pl-pds">"</span></span>;
    <span class="pl-st">String</span>[] columns <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">String</span>[] {<span class="pl-s1"><span class="pl-pds">"</span>age<span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>};
    <span class="pl-st">Object</span>[] values <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">Object</span>[] {<span class="pl-c1">42</span>, <span class="pl-s1"><span class="pl-pds">"</span>Fred<span class="pl-pds">"</span></span>};
    <span class="pl-stj">String</span> sql <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">ExampleLogic</span>()<span class="pl-k">.</span>generateInsertSql(tableName, columns, values);

    testmd<span class="pl-k">.</span>permutation()
            .addParameter(<span class="pl-s1"><span class="pl-pds">"</span>tableName<span class="pl-pds">"</span></span>, tableName)
            .addParameter(<span class="pl-s1"><span class="pl-pds">"</span>columns<span class="pl-pds">"</span></span>, columns)
            .addParameter(<span class="pl-s1"><span class="pl-pds">"</span>values<span class="pl-pds">"</span></span>, values)
            .addResult(<span class="pl-s1"><span class="pl-pds">"</span>sql<span class="pl-pds">"</span></span>, sql);
    <span class="pl-c">//GOING TO ADD MORE HERE</span>
}  </pre></div>

<p>You can include as many result key/value pairs as you need and if any of them are different, the permutation will be re-verified. In our case, we just have one result to worry about.</p>

<h4>
<a id="define-setup-logic" class="anchor" href="#define-setup-logic" aria-hidden="true"><span class="octicon octicon-link"></span></a>Define Setup Logic</h4>

<p>Now that we have the permutation defined, we can add logic for how to test it (if needed). First, there is usually some setup that needs to be done. This may include connecting to the database, truncating existing data, or anything else you need:</p>

<div class="highlight highlight-java"><pre><span class="pl-s">private</span> <span class="pl-stj">Connection</span> connection;

@<span class="pl-stj">Test</span>
<span class="pl-s">public</span> <span class="pl-st">void</span> insertingData_simple() throws <span class="pl-stj">Exception</span> {
    <span class="pl-stj">String</span> tableName <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>test_table<span class="pl-pds">"</span></span>;
    <span class="pl-st">String</span>[] columns <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">String</span>[] {<span class="pl-s1"><span class="pl-pds">"</span>age<span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>};
    <span class="pl-st">Object</span>[] values <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">Object</span>[] {<span class="pl-c1">42</span>, <span class="pl-s1"><span class="pl-pds">"</span>Fred<span class="pl-pds">"</span></span>};
    <span class="pl-stj">String</span> sql <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">ExampleLogic</span>()<span class="pl-k">.</span>generateInsertSql(tableName, columns, values);

    testmd<span class="pl-k">.</span>permutation()
            .addParameter(<span class="pl-s1"><span class="pl-pds">"</span>tableName<span class="pl-pds">"</span></span>, tableName)
            .addParameter(<span class="pl-s1"><span class="pl-pds">"</span>columns<span class="pl-pds">"</span></span>, columns)
            .addParameter(<span class="pl-s1"><span class="pl-pds">"</span>values<span class="pl-pds">"</span></span>, values)
            .addResult(<span class="pl-s1"><span class="pl-pds">"</span>sql<span class="pl-pds">"</span></span>, sql)
            .setup(<span class="pl-k">new</span> <span class="pl-stj">Setup</span>() {
                <span class="pl-st">@Override</span>
                <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">run</span>() <span class="pl-s">throws</span> <span class="pl-stj">SetupResult</span> {
                    openConnection();
                    <span class="pl-k">if</span> (connection <span class="pl-k">==</span> <span class="pl-c1">null</span>) {
                        <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-stj">SetupResult</span>.<span class="pl-stj">CannotVerify</span>(<span class="pl-s1"><span class="pl-pds">"</span>Connection not available<span class="pl-pds">"</span></span>);
                    }
                    resetDatabase();
                    <span class="pl-k">throw</span> <span class="pl-stj">SetupResult</span><span class="pl-c1"><span class="pl-k">.</span>OK</span>;
                }
            });
    <span class="pl-c">//GOING TO ADD MORE HERE</span>
}</pre></div>

<p>If you cannot set up the environment for testing, throw SetupResult.CannotVerify. If everything is correctly set up, throw SetupResult.OK.</p>

<h4>
<a id="define-cleanup-logic" class="anchor" href="#define-cleanup-logic" aria-hidden="true"><span class="octicon octicon-link"></span></a>Define Cleanup Logic</h4>

<p>If anything needs to be cleaned up after the test runs, add a "cleanup" call:</p>

<div class="highlight highlight-java"><pre>@<span class="pl-stj">Test</span>
<span class="pl-s">public</span> <span class="pl-st">void</span> insertingData_simple() throws <span class="pl-stj">Exception</span> {
    <span class="pl-stj">String</span> tableName <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>test_table<span class="pl-pds">"</span></span>;
    <span class="pl-st">String</span>[] columns <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">String</span>[]{<span class="pl-s1"><span class="pl-pds">"</span>age<span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>};
    <span class="pl-st">Object</span>[] values <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">Object</span>[]{<span class="pl-c1">42</span>, <span class="pl-s1"><span class="pl-pds">"</span>Fred<span class="pl-pds">"</span></span>};
    <span class="pl-stj">String</span> sql <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">ExampleLogic</span>()<span class="pl-k">.</span>generateInsertSql(tableName, columns, values);

    testmd<span class="pl-k">.</span>permutation()
            .addParameter(<span class="pl-s1"><span class="pl-pds">"</span>tableName<span class="pl-pds">"</span></span>, tableName)
            .addParameter(<span class="pl-s1"><span class="pl-pds">"</span>columns<span class="pl-pds">"</span></span>, columns)
            .addParameter(<span class="pl-s1"><span class="pl-pds">"</span>values<span class="pl-pds">"</span></span>, values)
            .addResult(<span class="pl-s1"><span class="pl-pds">"</span>sql<span class="pl-pds">"</span></span>, sql)
            .setup(<span class="pl-k">new</span> <span class="pl-stj">Setup</span>() {
                <span class="pl-st">@Override</span>
                <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">run</span>() <span class="pl-s">throws</span> <span class="pl-stj">SetupResult</span> {
                    openConnection();
                    <span class="pl-k">if</span> (connection <span class="pl-k">==</span> <span class="pl-c1">null</span>) {
                        <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-stj">SetupResult</span>.<span class="pl-stj">CannotVerify</span>(<span class="pl-s1"><span class="pl-pds">"</span>Connection not available<span class="pl-pds">"</span></span>);
                    }
                    resetDatabase();
                    <span class="pl-k">throw</span> <span class="pl-stj">SetupResult</span><span class="pl-c1"><span class="pl-k">.</span>OK</span>;
                }
            })<span class="pl-k">.</span>cleanup(<span class="pl-k">new</span> <span class="pl-stj">Cleanup</span>() {
                <span class="pl-st">@Override</span>
                <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">run</span>() <span class="pl-s">throws</span> <span class="pl-stj">CleanupException</span> {
                    closeConnection();
                }
    });
    <span class="pl-c">//GOING TO ADD MORE HERE</span>
}</pre></div>

<h4>
<a id="define-assertion-logic" class="anchor" href="#define-assertion-logic" aria-hidden="true"><span class="octicon octicon-link"></span></a>Define Assertion Logic</h4>

<p>We are now ready for our actual assertions and our final code:</p>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">ExampleJUnitTest</span> {

    <span class="pl-st">@Rule</span>
    <span class="pl-s">public</span> <span class="pl-stj">TestMDRule</span> testmd <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">TestMDRule</span>();
    <span class="pl-s">private</span> <span class="pl-stj">Connection</span> connection;

    <span class="pl-st">@Test</span>
    <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">insertingData_simple</span>() <span class="pl-s">throws</span> <span class="pl-stj">Exception</span> {
        <span class="pl-s">final</span> <span class="pl-stj">String</span> tableName <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>test_table<span class="pl-pds">"</span></span>;
        <span class="pl-s">final</span> <span class="pl-st">String</span>[] columns <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">String</span>[]{<span class="pl-s1"><span class="pl-pds">"</span>age<span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>};
        <span class="pl-s">final</span> <span class="pl-st">Object</span>[] values <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">Object</span>[]{<span class="pl-c1">42</span>, <span class="pl-s1"><span class="pl-pds">"</span>Fred<span class="pl-pds">"</span></span>};
        <span class="pl-s">final</span> <span class="pl-stj">String</span> sql <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">ExampleLogic</span>()<span class="pl-k">.</span>generateInsertSql(tableName, columns, values);

        testmd<span class="pl-k">.</span>permutation()
                .addParameter(<span class="pl-s1"><span class="pl-pds">"</span>tableName<span class="pl-pds">"</span></span>, tableName)
                .addParameter(<span class="pl-s1"><span class="pl-pds">"</span>columns<span class="pl-pds">"</span></span>, columns)
                .addParameter(<span class="pl-s1"><span class="pl-pds">"</span>values<span class="pl-pds">"</span></span>, values)
                .addResult(<span class="pl-s1"><span class="pl-pds">"</span>sql<span class="pl-pds">"</span></span>, sql)
                .setup(<span class="pl-k">new</span> <span class="pl-stj">Setup</span>() {
                    <span class="pl-st">@Override</span>
                    <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">run</span>() <span class="pl-s">throws</span> <span class="pl-stj">SetupResult</span> {
                        openConnection();
                        <span class="pl-k">if</span> (connection <span class="pl-k">==</span> <span class="pl-c1">null</span>) {
                            <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-stj">SetupResult</span>.<span class="pl-stj">CannotVerify</span>(<span class="pl-s1"><span class="pl-pds">"</span>Connection not available<span class="pl-pds">"</span></span>);
                        }
                        resetDatabase();
                        <span class="pl-k">throw</span> <span class="pl-stj">SetupResult</span><span class="pl-c1"><span class="pl-k">.</span>OK</span>;
                    }
                })<span class="pl-k">.</span>cleanup(<span class="pl-k">new</span> <span class="pl-stj">Cleanup</span>() {
                    <span class="pl-st">@Override</span>
                    <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">run</span>() <span class="pl-s">throws</span> <span class="pl-stj">CleanupException</span> {
                        closeConnection();
                    }
        })<span class="pl-k">.</span>run(<span class="pl-k">new</span> <span class="pl-stj">Verification</span>() {
            <span class="pl-st">@Override</span>
            <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">run</span>() <span class="pl-s">throws</span> <span class="pl-stj">CannotVerifyException</span>, <span class="pl-stj">AssertionError</span> {
                executeSql(sql);
                assertDataInserted(tableName, columns, values);
            }
        });
    }
}</pre></div>

<p>Within the <em>Verification</em> call, you actually execute the genearted SQL, then run any assertion logic you need to ensure that it runs successfully.</p>

<h4>
<a id="run-the-test" class="anchor" href="#run-the-test" aria-hidden="true"><span class="octicon octicon-link"></span></a>Run The Test</h4>

<p>Now run your test method like you would run any JUnit test. The first time it executes, it will take longer to execute--especially if you have real database connection logic in <em>openConnection()</em> and <em>executeSql()</em>.</p>

<p>Running it a second time, however, will take virtually no time at all. The secret is the <a href="src/test/resources/com/example/ExampleJUnitTest.insertingData_simple.accepted.md">src/test/resources/com/example/ExampleJUnitTest.insertingData_simple.accepted.md</a> file that gets created in on your file system. That file stores the fact that the <em>ExampleJUnitTest.insertingData_simple</em> test was ran successfully with "table=test_table, columns=[age, name] and values=[42, Fred]". It also lists the SQL that was executed as the result.</p>

<p>If you manually edit the sql stored in the accepted.md file and re-run your test, you will see that the SQL is re-executed and verified and the file is re-written as verified again. </p>

<p>If you delete the existing accepted.md file and change the <em>Setup</em> logic to throw a <em>SetupResult.CannotVerify</em> exception, when you rerun the test the file will be re-written and the test will be marked as "UNVERIFIED: Connection not available". Make the test no longer throw <em>CannotVerify</em> and re-run the test and it will be saved as VERIFIED.</p>

<h4>
<a id="commit-the-acceptedmd-file" class="anchor" href="#commit-the-acceptedmd-file" aria-hidden="true"><span class="octicon octicon-link"></span></a>Commit The accepted.md File</h4>

<p>Whenever you have a new test using TestMD, commit the corresponding accepted.md files. Now any other developers running your tests will only need to re-verify the SQL if they make a change that alters the generated SQL. </p>

<p>As you are working on your application, watch for changes to accepted.md files. Are there suddenly results that changed unexpectedly? Are those changes verified? The markdown format is designed to be easily readable in any diff program so watch them as part of every commit.</p>

<p>Are you wondering what has been tested? The markdown format is also designed to be readable through GitHub or any other markdown compatible web view. Simply go to the directory containing your tests such as <a href="src/test/resources/com/example/">src/test/resources/com/example</a> and read through what has been tested.</p>

<h4>
<a id="multiple-permutation-per-test" class="anchor" href="#multiple-permutation-per-test" aria-hidden="true"><span class="octicon octicon-link"></span></a>Multiple Permutation Per Test</h4>

<p>Usually, one test of a method is not enough to ensure it is working correctly--you need to test it with multiple different value permutations. The TestMD accepted.md format is designed to group multiple different test runs into a single test file for easier readability. </p>

<p>For a given testClass/testName combination, you can define as many permutations as you want. Each one is uniquely identified by its parameters and re-ran if the results change.</p>

<p>In this test:</p>

<div class="highlight highlight-java"><pre>@<span class="pl-stj">Test</span>
<span class="pl-s">public</span> <span class="pl-st">void</span> insertingData() throws <span class="pl-stj">Exception</span> {
    <span class="pl-stj">ExampleLogic</span> logic <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">ExampleLogic</span>();

    <span class="pl-st">Object</span>[][] permutations <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">Object</span>[][]{
            <span class="pl-k">new</span> <span class="pl-stj">Object</span>[]{<span class="pl-s1"><span class="pl-pds">"</span>person<span class="pl-pds">"</span></span>, <span class="pl-k">new</span> <span class="pl-stj">String</span>[]{<span class="pl-s1"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>}, <span class="pl-k">new</span> <span class="pl-stj">Object</span>[]{<span class="pl-s1"><span class="pl-pds">"</span>Bob<span class="pl-pds">"</span></span>}},
            <span class="pl-k">new</span> <span class="pl-stj">Object</span>[]{<span class="pl-s1"><span class="pl-pds">"</span>person<span class="pl-pds">"</span></span>, <span class="pl-k">new</span> <span class="pl-stj">String</span>[]{<span class="pl-s1"><span class="pl-pds">"</span>age<span class="pl-pds">"</span></span>}, <span class="pl-k">new</span> <span class="pl-stj">Object</span>[]{<span class="pl-c1">42</span>}},
            <span class="pl-k">new</span> <span class="pl-stj">Object</span>[]{<span class="pl-s1"><span class="pl-pds">"</span>person<span class="pl-pds">"</span></span>, <span class="pl-k">new</span> <span class="pl-stj">String</span>[]{<span class="pl-s1"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span>age<span class="pl-pds">"</span></span>}, <span class="pl-k">new</span> <span class="pl-stj">Object</span>[]{<span class="pl-s1"><span class="pl-pds">"</span>Joe<span class="pl-pds">"</span></span>, <span class="pl-c1">55</span>}},
            <span class="pl-k">new</span> <span class="pl-stj">Object</span>[]{<span class="pl-s1"><span class="pl-pds">"</span>address<span class="pl-pds">"</span></span>, <span class="pl-k">new</span> <span class="pl-stj">String</span>[]{<span class="pl-s1"><span class="pl-pds">"</span>address1<span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span>address2<span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span>city<span class="pl-pds">"</span></span>}, <span class="pl-k">new</span> <span class="pl-stj">Object</span>[]{<span class="pl-s1"><span class="pl-pds">"</span>121 Main<span class="pl-pds">"</span></span>, <span class="pl-c1">null</span>, <span class="pl-s1"><span class="pl-pds">"</span>New Town<span class="pl-pds">"</span></span>}}
    };

    <span class="pl-k">for</span> (<span class="pl-st">Object</span>[] permutation <span class="pl-k">:</span> permutations) {
        <span class="pl-s">final</span> <span class="pl-stj">String</span> tableName <span class="pl-k">=</span> (<span class="pl-stj">String</span>) permutation[<span class="pl-c1">0</span>];
        <span class="pl-s">final</span> <span class="pl-st">String</span>[] columns <span class="pl-k">=</span> (<span class="pl-st">String</span>[]) permutation[<span class="pl-c1">1</span>];
        <span class="pl-s">final</span> <span class="pl-st">Object</span>[] values <span class="pl-k">=</span> (<span class="pl-st">Object</span>[]) permutation[<span class="pl-c1">2</span>];

        <span class="pl-s">final</span> <span class="pl-stj">String</span> sql <span class="pl-k">=</span> logic<span class="pl-k">.</span>generateInsertSql(tableName, columns, values);
        testmd<span class="pl-k">.</span>permutation()
                .addParameter(<span class="pl-s1"><span class="pl-pds">"</span>table<span class="pl-pds">"</span></span>, tableName)
                .addParameter(<span class="pl-s1"><span class="pl-pds">"</span>columns<span class="pl-pds">"</span></span>, columns)
                .addParameter(<span class="pl-s1"><span class="pl-pds">"</span>values<span class="pl-pds">"</span></span>, values)
                .addResult(<span class="pl-s1"><span class="pl-pds">"</span>sql<span class="pl-pds">"</span></span>, sql)
                .run(<span class="pl-k">new</span> <span class="pl-stj">Verification</span>() {
                    <span class="pl-st">@Override</span>
                    <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">run</span>() {
                        executeSql(sql);
                        assertDataInserted(tableName, columns, values);
                    }
                });
    }
}</pre></div>

<p>we define multiple permutations and then loop through them with a resulting file that looks like <a href="src/test/resources/com/example/ExampleJUnitTest.insertingData.accepted.md">src/test/resources/com/example/ExampleJUnitTest.insertingData.accepted.md</a></p>

<h4>
<a id="formatting-permutations-as-a-table" class="anchor" href="#formatting-permutations-as-a-table" aria-hidden="true"><span class="octicon octicon-link"></span></a>Formatting Permutations As A Table</h4>

<p>Depending on what is being tested, it sometimes helps readability to group permutations in a table. Adding a call to <em>.asTable(parameterNames)</em> in the permutation definition allows you define the names of the parameters that should be used in the table.</p>

<p>For example:</p>

<div class="highlight highlight-java"><pre>@<span class="pl-stj">Test</span>
<span class="pl-s">public</span> <span class="pl-st">void</span> insertingDataFormattedAsTable() throws <span class="pl-stj">Exception</span> {
    <span class="pl-stj">ExampleLogic</span> logic <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">ExampleLogic</span>();

    <span class="pl-st">Object</span>[][] permutations <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">Object</span>[][]{
            <span class="pl-k">new</span> <span class="pl-stj">Object</span>[]{<span class="pl-s1"><span class="pl-pds">"</span>person<span class="pl-pds">"</span></span>, <span class="pl-k">new</span> <span class="pl-stj">String</span>[]{<span class="pl-s1"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>}, <span class="pl-k">new</span> <span class="pl-stj">Object</span>[]{<span class="pl-s1"><span class="pl-pds">"</span>Bob<span class="pl-pds">"</span></span>}},
            <span class="pl-k">new</span> <span class="pl-stj">Object</span>[]{<span class="pl-s1"><span class="pl-pds">"</span>person<span class="pl-pds">"</span></span>, <span class="pl-k">new</span> <span class="pl-stj">String</span>[]{<span class="pl-s1"><span class="pl-pds">"</span>age<span class="pl-pds">"</span></span>}, <span class="pl-k">new</span> <span class="pl-stj">Object</span>[]{<span class="pl-c1">42</span>}},
            <span class="pl-k">new</span> <span class="pl-stj">Object</span>[]{<span class="pl-s1"><span class="pl-pds">"</span>person<span class="pl-pds">"</span></span>, <span class="pl-k">new</span> <span class="pl-stj">String</span>[]{<span class="pl-s1"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span>age<span class="pl-pds">"</span></span>}, <span class="pl-k">new</span> <span class="pl-stj">Object</span>[]{<span class="pl-s1"><span class="pl-pds">"</span>Joe<span class="pl-pds">"</span></span>, <span class="pl-c1">55</span>}},
            <span class="pl-k">new</span> <span class="pl-stj">Object</span>[]{<span class="pl-s1"><span class="pl-pds">"</span>address<span class="pl-pds">"</span></span>, <span class="pl-k">new</span> <span class="pl-stj">String</span>[]{<span class="pl-s1"><span class="pl-pds">"</span>address1<span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span>address2<span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span>city<span class="pl-pds">"</span></span>}, <span class="pl-k">new</span> <span class="pl-stj">Object</span>[]{<span class="pl-s1"><span class="pl-pds">"</span>121 Main<span class="pl-pds">"</span></span>, <span class="pl-c1">null</span>, <span class="pl-s1"><span class="pl-pds">"</span>New Town<span class="pl-pds">"</span></span>}}
    };

    <span class="pl-k">for</span> (<span class="pl-st">Object</span>[] permutation <span class="pl-k">:</span> permutations) {
        <span class="pl-s">final</span> <span class="pl-stj">String</span> tableName <span class="pl-k">=</span> (<span class="pl-stj">String</span>) permutation[<span class="pl-c1">0</span>];
        <span class="pl-s">final</span> <span class="pl-st">String</span>[] columns <span class="pl-k">=</span> (<span class="pl-st">String</span>[]) permutation[<span class="pl-c1">1</span>];
        <span class="pl-s">final</span> <span class="pl-st">Object</span>[] values <span class="pl-k">=</span> (<span class="pl-st">Object</span>[]) permutation[<span class="pl-c1">2</span>];

        <span class="pl-s">final</span> <span class="pl-stj">String</span> sql <span class="pl-k">=</span> logic<span class="pl-k">.</span>generateInsertSql(tableName, columns, values);
        testmd<span class="pl-k">.</span>permutation()
                .addParameter(<span class="pl-s1"><span class="pl-pds">"</span>table<span class="pl-pds">"</span></span>, tableName)
                .addParameter(<span class="pl-s1"><span class="pl-pds">"</span>columns<span class="pl-pds">"</span></span>, columns)
                .addParameter(<span class="pl-s1"><span class="pl-pds">"</span>values<span class="pl-pds">"</span></span>, values)
                .asTable(<span class="pl-s1"><span class="pl-pds">"</span>columns<span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span>values<span class="pl-pds">"</span></span>)
                .addResult(<span class="pl-s1"><span class="pl-pds">"</span>sql<span class="pl-pds">"</span></span>, sql)
                .run(<span class="pl-k">new</span> <span class="pl-stj">Verification</span>() {
                    <span class="pl-st">@Override</span>
                    <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">run</span>() {
                        executeSql(sql);
                        assertDataInserted(tableName, columns, values);
                    }
                });
    }

}</pre></div>

<p>will save the results as <a href="src/test/resources/com/example/ExampleJUnitTest.insertingDataFormattedAsTable.accepted.md">src/test/resources/com/example/ExampleJUnitTest.insertingDataFormattedAsTable.accepted.md</a>.</p>

<p>Functionality-wise there is no difference between table-formatted and regular-formatted accepted.md files. Use whatever is most readable for each test.</p>

<h2>
<a id="other-uses-not-just-sql" class="anchor" href="#other-uses-not-just-sql" aria-hidden="true"><span class="octicon octicon-link"></span></a>Other Uses: Not Just SQL</h2>

<p>TestMD works well any time you are able to describe the interaction between two systems in a simple yet deterministic way. </p>

<p>REST-style webservices work well with TestMD:</p>

<div class="highlight highlight-java"><pre>@<span class="pl-stj">Test</span>
<span class="pl-s">public</span> <span class="pl-st">void</span> queryAPI() throws <span class="pl-stj">Exception</span> {
    <span class="pl-stj">ExampleLogic</span> logic <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">ExampleLogic</span>();

    <span class="pl-st">Object</span>[][] permutations <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">Object</span>[][]{
            <span class="pl-k">new</span> <span class="pl-stj">Object</span>[]{<span class="pl-s1"><span class="pl-pds">"</span>cars<span class="pl-pds">"</span></span>, <span class="pl-c1">4</span>},
            <span class="pl-k">new</span> <span class="pl-stj">Object</span>[]{<span class="pl-s1"><span class="pl-pds">"</span>testing examples<span class="pl-pds">"</span></span>, <span class="pl-c1">3</span>},
            <span class="pl-k">new</span> <span class="pl-stj">Object</span>[]{<span class="pl-s1"><span class="pl-pds">"</span>junit alternatives<span class="pl-pds">"</span></span>, <span class="pl-c1">3</span>},
            <span class="pl-k">new</span> <span class="pl-stj">Object</span>[]{<span class="pl-s1"><span class="pl-pds">"</span>junit alternatives<span class="pl-pds">"</span></span>, <span class="pl-c1">3</span>}
    };

    <span class="pl-k">for</span> (<span class="pl-st">Object</span>[] permutation <span class="pl-k">:</span> permutations) {
        <span class="pl-s">final</span> <span class="pl-stj">String</span> keywords <span class="pl-k">=</span> (<span class="pl-stj">String</span>) permutation[<span class="pl-c1">0</span>];
        <span class="pl-st">int</span> version <span class="pl-k">=</span> (<span class="pl-stj">Integer</span>) permutation[<span class="pl-c1">1</span>];
        <span class="pl-s">final</span> <span class="pl-stj">String</span> query <span class="pl-k">=</span> logic<span class="pl-k">.</span>generateQueryRequest(version, keywords);
        testmd<span class="pl-k">.</span>permutation()<span class="pl-k">.</span>addParameter(<span class="pl-s1"><span class="pl-pds">"</span>keywords<span class="pl-pds">"</span></span>, keywords)
                .addParameter(<span class="pl-s1"><span class="pl-pds">"</span>version<span class="pl-pds">"</span></span>, version)
                .asTable(<span class="pl-s1"><span class="pl-pds">"</span>keywords<span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span>version<span class="pl-pds">"</span></span>)
                .addResult(<span class="pl-s1"><span class="pl-pds">"</span>query<span class="pl-pds">"</span></span>, query)
                .run(<span class="pl-k">new</span> <span class="pl-stj">Verification</span>() {
                    <span class="pl-st">@Override</span>
                    <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">run</span>() {
                        assertQueryResults(query, keywords);
                    }
                });

    }
}</pre></div>

<p>As do:</p>

<ul>
<li>NoSQL database interactions </li>
<li>SOAP and RPC calls</li>
<li>And More</li>
</ul>

<h2>
<a id="spock-example" class="anchor" href="#spock-example" aria-hidden="true"><span class="octicon octicon-link"></span></a>Spock Example</h2>

<p>TestMD is designed to work well with the Spock testing framework. Because of the improved permutation support in Spock, the tests tend to be even cleaner than JUnit.</p>

<div class="highlight highlight-groovy"><pre><span class="pl-st">@Unroll</span>
<span class="pl-st">def</span> <span class="pl-s1"><span class="pl-pds">"</span>inserting data<span class="pl-pds">"</span></span>() {
    <span class="pl-c1">expect</span>:
    <span class="pl-st">ExampleLogic</span> logic <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-st">ExampleLogic</span>();

    <span class="pl-c">//Using TestMD.test directly to avoid a separate accepted.md file for each permutation</span>
    <span class="pl-st">def</span> sql <span class="pl-k">=</span> logic<span class="pl-k">.</span>generateInsertSql(tableName, columns, values)
    <span class="pl-st">TestMD</span><span class="pl-k">.</span>test(<span class="pl-v">this</span><span class="pl-k">.</span>class, <span class="pl-s1"><span class="pl-pds">"</span>inserting data<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>permutation([<span class="pl-c1">table</span>: tableName, <span class="pl-c1">columns</span>: columns, <span class="pl-c1">values</span>: values])
            .addResult(<span class="pl-s1"><span class="pl-pds">"</span>sql<span class="pl-pds">"</span></span>, sql)
            .run({
        executeSql(sql)
        assertDataInserted(tableName, columns, values)
    } <span class="pl-k">as</span> <span class="pl-st">Verification</span>)

    <span class="pl-c1">where</span>:
    tableName | columns                                      | values
    <span class="pl-s1"><span class="pl-pds">"</span>person<span class="pl-pds">"</span></span>  | [<span class="pl-s1"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>] <span class="pl-k">as</span> <span class="pl-st">String</span>[]                         | [<span class="pl-s1"><span class="pl-pds">"</span>Bob<span class="pl-pds">"</span></span>] <span class="pl-k">as</span> <span class="pl-st">Object</span>[]
    <span class="pl-s1"><span class="pl-pds">"</span>person<span class="pl-pds">"</span></span>  | [<span class="pl-s1"><span class="pl-pds">"</span>age<span class="pl-pds">"</span></span>] <span class="pl-k">as</span> <span class="pl-st">String</span>[]                          | [<span class="pl-c1">42</span>] <span class="pl-k">as</span> <span class="pl-st">Object</span>[]
    <span class="pl-s1"><span class="pl-pds">"</span>person<span class="pl-pds">"</span></span>  | [<span class="pl-s1"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span>age<span class="pl-pds">"</span></span>] <span class="pl-k">as</span> <span class="pl-st">String</span>[]                  | [<span class="pl-s1"><span class="pl-pds">"</span>Joe<span class="pl-pds">"</span></span>, <span class="pl-c1">55</span>] <span class="pl-k">as</span> <span class="pl-st">Object</span>[]
    <span class="pl-s1"><span class="pl-pds">"</span>address<span class="pl-pds">"</span></span> | [<span class="pl-s1"><span class="pl-pds">"</span>address1<span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span>address2<span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span>city<span class="pl-pds">"</span></span>] <span class="pl-k">as</span> <span class="pl-st">String</span>[] | [<span class="pl-s1"><span class="pl-pds">"</span>121 Main<span class="pl-pds">"</span></span>, <span class="pl-c1">null</span>, <span class="pl-s1"><span class="pl-pds">"</span>New Town<span class="pl-pds">"</span></span>] <span class="pl-k">as</span> <span class="pl-st">Object</span>[]
}</pre></div>

<h2>
<a id="final-details" class="anchor" href="#final-details" aria-hidden="true"><span class="octicon octicon-link"></span></a>Final Details</h2>

<ul>
<li>Congratulations on reading all the way to the bottom of this README.</li>
<li>If you have any bugs or feature enhancements, use the Github Project Issues</li>
<li>Pull requests area always appreciated</li>
<li>Feel free to contact me at <a href="mailto:nathan@liquibase.org">nathan@liquibase.org</a> or <a href="https://twitter.com/nvoxland">@nvoxland</a> with any additional questions or comments</li>
<li>Each permutation in the accepted.md files contain a 6 digit alphanumeric "key" that is used to easily identify the permutation, even if the order is shifted.</li>
<li>The accepted.md file stores results in an automatically-sorted manner to make diffs more consistent.</li>
<li>You can control the formatting of parameters and results in the accepted.md file with a <a href="http://nvoxland.github.io/testmd/javadoc/testmd/ValueFormat.html">ValueFormat</a> object if needed. Just use the overloaded <em>addParameter()</em> and <em>addResult()</em> methods.</li>
<li>You can call <em>addNote(key, note)</em> to your permutation definition to save informational notes in the accepted.md file. These notes do not affect the identification of permutations or the decision to re-verify them.</li>
<li>Javadoc is available at <a href="http://nvoxland.github.io/testmd/javadoc/index.html">http://nvoxland.github.io/testmd/javadoc</a>
</li>
<li>Happy Testing!</li>
</ul>
      </section>
      <footer>
        <p>Project maintained by <a href="https://github.com/nvoxland">nvoxland</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://twitter.com/michigangraham">mattgraham</a></small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-57739912-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>